import CodeOutputBlock from '../../code-output-block.jsx';

# Streaming Structured Data


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->


```python
# Few imports and global variables
from rich import print
import guardrails as gd
from IPython.display import clear_output
import time
```

### Setup

Install and import the necessary validators from Guardrails hub


```python
try:
    from guardrails.hub import LowerCase, UpperCase, ValidRange, OneLine
except ImportError:
    gd.install("hub://guardrails/valid_range")
    gd.install("hub://guardrails/uppercase")
    gd.install("hub://guardrails/lowercase")
    gd.install("hub://guardrails/one_line")
    from guardrails.hub import LowerCase, UpperCase, ValidRange, OneLine
```

### 1. For structured JSON output


#### Define the prompt and output schema



```python
from pydantic import BaseModel, Field
from typing import List

prompt = """
Given the following doctor's notes about a patient, please extract a dictionary that contains the patient's information.

${doctors_notes}

${gr.complete_xml_suffix_v2}
"""

doctors_notes = """152 y/o female with chronic macular rash to face and hair, worse in beard, eyebrows and nares.
The rash is itchy, flaky and slightly scaly. Moderate response to OTC steroid cream. Patient has been using cream for 2 weeks and also suffers from diabetes."""


class Symptom(BaseModel):
    symptom: str = Field(description="Symptom that a patient is experiencing")
    affected_area: str = Field(
        description="What part of the body the symptom is affecting",
        validators=[
            LowerCase(on_fail="fix"),
        ],
    )


class Medication(BaseModel):
    medication: str = Field(
        description="Name of the medication the patient is taking",
        validators=[UpperCase(on_fail="fix")],
    )
    response: str = Field(description="How the patient is responding to the medication")


class PatientInfo(BaseModel):
    gender: str = Field(description="Patient's gender")
    age: int = Field(
        description="Patient's age",
        validators=[ValidRange(min=0, max=100, on_fail="fix")],
    )
    symptoms: List[Symptom] = Field(
        description="Symptoms that the patient is currently experiencing. Each symptom should be classified into  separate item in the list."
    )
    current_meds: List[Medication] = Field(
        description="Medications the patient is currently taking and their response"
    )
    miscellaneous: str = Field(
        description="Any other information that is relevant to the patient's health; something that doesn't fit into the other categories.",
        validators=[LowerCase(on_fail="fix"), OneLine(on_fail="fix")],
    )
```

#### Create the Guard object



```python
guard = gd.Guard.for_pydantic(output_class=PatientInfo)
```

##### Example 1: No streaming

By default, the `stream` parameter is set to `False`



```python
# Wrap the litellm OpenAI API call with the `guard` object
raw_llm_output, validated_output, *rest = guard(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": prompt}],
    prompt_params={"doctors_notes": doctors_notes},
    max_tokens=1024,
    temperature=0.3,
)

# Print the validated output from the LLM
print(validated_output)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "/Users/dtam/dev/guardrails/guardrails/validator_service/__init__.py:85: UserWarning: Could not obtain an event loop. Falling back to synchronous validation.<br />      warnings.warn(<br /><br /><br /><br /><br /><pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\">{</span><br />    <span style=\"color: #008000; text-decoration-color: #008000\">'gender'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'female'</span>,<br />    <span style=\"color: #008000; text-decoration-color: #008000\">'age'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">100</span>,<br />    <span style=\"color: #008000; text-decoration-color: #008000\">'symptoms'</span>: <span style=\"font-weight: bold\">[</span><br />        <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'chronic macular rash'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'face'</span><span style=\"font-weight: bold\">}</span>,<br />        <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'itchy'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'beard'</span><span style=\"font-weight: bold\">}</span>,<br />        <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'flaky'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'eyebrows'</span><span style=\"font-weight: bold\">}</span>,<br />        <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'slightly scaly'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'nares'</span><span style=\"font-weight: bold\">}</span><br />    <span style=\"font-weight: bold\">]</span>,<br />    <span style=\"color: #008000; text-decoration-color: #008000\">'current_meds'</span>: <span style=\"font-weight: bold\">[{</span><span style=\"color: #008000; text-decoration-color: #008000\">'medication'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'OTC STEROID CREAM'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'response'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'moderate'</span><span style=\"font-weight: bold\">}]</span>,<br />    <span style=\"color: #008000; text-decoration-color: #008000\">'miscellaneous'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'patient also suffers from diabetes'</span><br /><span style=\"font-weight: bold\">}</span><br /></pre>"}} />


```python
# Let's see the logs
print(guard.history.last.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />└── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                      </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │ user │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Given the following doctor's notes about a patient, please extract a dictionary that         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ contains the patient's information.                                                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 152 y/o female with chronic macular rash to face and hair, worse in beard, eyebrows and      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ nares.                                                                                       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ The rash is itchy, flaky and slightly scaly. Moderate response to OTC steroid cream. Patient │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ has been using cream for 2 weeks and also suffers from diabetes.                             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Given below is XML that describes the information to extract from this document and the tags │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ to extract it into.                                                                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;output&gt;                                                                                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;string description=\"Patient's gender\" name=\"gender\" required=\"true\"&gt;&lt;/string&gt;             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;integer description=\"Patient's age\" format=\"guardrails/valid_range: 0 100\" name=\"age\"     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ required=\"true\"&gt;&lt;/integer&gt;                                                                   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;list description=\"Symptoms that the patient is currently experiencing. Each symptom       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ should be classified into  separate item in the list.\" name=\"symptoms\" required=\"true\"&gt;      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;object required=\"true\"&gt;                                                                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"Symptom that a patient is experiencing\" name=\"symptom\"            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ required=\"true\"&gt;&lt;/string&gt;                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"What part of the body the symptom is affecting\"                   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/lowercase\" name=\"affected_area\" required=\"true\"&gt;&lt;/string&gt;                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;/object&gt;                                                                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;/list&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;list description=\"Medications the patient is currently taking and their response\"         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ name=\"current_meds\" required=\"true\"&gt;                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;object required=\"true\"&gt;                                                                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"Name of the medication the patient is taking\"                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/uppercase\" name=\"medication\" required=\"true\"&gt;&lt;/string&gt;                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"How the patient is responding to the medication\" name=\"response\"  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ required=\"true\"&gt;&lt;/string&gt;                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;/object&gt;                                                                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;/list&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;string description=\"Any other information that is relevant to the patient's health;       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ something that doesn't fit into the other categories.\" format=\"guardrails/lowercase;         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ guardrails/one_line\" name=\"miscellaneous\" required=\"true\"&gt;&lt;/string&gt;                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;/output&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ ONLY return a valid JSON object (no other text is necessary), where the key of the field in  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ JSON is the `name` attribute of the corresponding XML, and the value is of the type          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ specified by the corresponding XML's tag. The JSON MUST conform to the XML format, including │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ any types and format requests e.g. requests for lists, objects and specific types. Be        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ correct and concise.                                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Here are examples of simple (XML, JSON) pairs that show the expected behavior:               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE',        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 'STRING TWO', etc.]}`                                                                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ name=\"index\" format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index':     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 1}}`                                                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └──────┴──────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"gender\": \"female\",                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"age\": 152,                                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"symptoms\": [                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"chronic macular rash\",                                                          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"face\"                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"itchy\",                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"beard\"                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"flaky\",                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"eyebrows\"                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"slightly scaly\",                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"nares\"                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         }                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"current_meds\": [                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"medication\": \"OTC steroid cream\",                                                          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"response\": \"moderate\"                                                                      │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         }                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"miscellaneous\": \"patient also suffers from diabetes\"                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'gender': 'female',                                                                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'age': 100,                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'symptoms': [                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'chronic macular rash', 'affected_area': 'face'},                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'itchy', 'affected_area': 'beard'},                                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'flaky', 'affected_area': 'eyebrows'},                                              │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'slightly scaly', 'affected_area': 'nares'}                                         │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'current_meds': [                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'medication': 'OTC STEROID CREAM', 'response': 'moderate'}                                     │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'miscellaneous': 'patient also suffers from diabetes'                                               │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />

##### Example 2: Streaming

Set the `stream` parameter to `True`



```python
# Wrap the litellm OpenAI API call with the `guard` object
fragment_generator = guard(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": prompt}],
    prompt_params={"doctors_notes": doctors_notes},
    max_tokens=1024,
    temperature=0,
    stream=True,
)


for op in fragment_generator:
    clear_output(wait=True)
    print(op)
    time.sleep(0.5)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">ValidationOutcome</span><span style=\"font-weight: bold\">(</span><br />    <span style=\"color: #808000; text-decoration-color: #808000\">call_id</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'14411405568'</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">raw_llm_output</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'{\n    \"gender\": \"female\",\n    \"age\": 152,\n    \"symptoms\": [\n        {\n            </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">\"symptom\": \"chronic macular rash\",\n            \"affected_area\": \"face\"\n        },\n        {\n            </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">\"symptom\": \"itchy\",\n            \"affected_area\": \"beard\"\n        },\n        {\n            \"symptom\": \"flaky\",\n</span><br /><span style=\"color: #008000; text-decoration-color: #008000\">\"affected_area\": \"eyebrows\"\n        },\n        {\n            \"symptom\": \"slightly scaly\",\n            </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">\"affected_area\": \"nares\"\n        }\n    ],\n    \"current_meds\": [\n        {\n            \"medication\": \"OTC </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">steroid cream\",\n            \"response\": \"moderate\"\n        }\n    ],\n    \"miscellaneous\": \"patient also suffers </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">from diabetes\"\n}'</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">validation_summaries</span>=<span style=\"font-weight: bold\">[]</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">validated_output</span>=<span style=\"font-weight: bold\">{</span><br />        <span style=\"color: #008000; text-decoration-color: #008000\">'gender'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'female'</span>,<br />        <span style=\"color: #008000; text-decoration-color: #008000\">'age'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">100</span>,<br />        <span style=\"color: #008000; text-decoration-color: #008000\">'symptoms'</span>: <span style=\"font-weight: bold\">[</span><br />            <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'chronic macular rash'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'face'</span><span style=\"font-weight: bold\">}</span>,<br />            <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'itchy'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'beard'</span><span style=\"font-weight: bold\">}</span>,<br />            <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'flaky'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'eyebrows'</span><span style=\"font-weight: bold\">}</span>,<br />            <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'slightly scaly'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'nares'</span><span style=\"font-weight: bold\">}</span><br />        <span style=\"font-weight: bold\">]</span>,<br />        <span style=\"color: #008000; text-decoration-color: #008000\">'current_meds'</span>: <span style=\"font-weight: bold\">[{</span><span style=\"color: #008000; text-decoration-color: #008000\">'medication'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'OTC STEROID CREAM'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'response'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'moderate'</span><span style=\"font-weight: bold\">}]</span>,<br />        <span style=\"color: #008000; text-decoration-color: #008000\">'miscellaneous'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'patient also suffers from diabetes'</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">reask</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">validation_passed</span>=<span style=\"color: #00ff00; text-decoration-color: #00ff00; font-style: italic\">True</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">error</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span><br /><span style=\"font-weight: bold\">)</span><br /></pre>"}} />


```python
# Let's see the logs
print(guard.history.last.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />└── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                      </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │ user │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Given the following doctor's notes about a patient, please extract a dictionary that         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ contains the patient's information.                                                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 152 y/o female with chronic macular rash to face and hair, worse in beard, eyebrows and      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ nares.                                                                                       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ The rash is itchy, flaky and slightly scaly. Moderate response to OTC steroid cream. Patient │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ has been using cream for 2 weeks and also suffers from diabetes.                             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Given below is XML that describes the information to extract from this document and the tags │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ to extract it into.                                                                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;output&gt;                                                                                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;string description=\"Patient's gender\" name=\"gender\" required=\"true\"&gt;&lt;/string&gt;             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;integer description=\"Patient's age\" format=\"guardrails/valid_range: 0 100\" name=\"age\"     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ required=\"true\"&gt;&lt;/integer&gt;                                                                   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;list description=\"Symptoms that the patient is currently experiencing. Each symptom       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ should be classified into  separate item in the list.\" name=\"symptoms\" required=\"true\"&gt;      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;object required=\"true\"&gt;                                                                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"Symptom that a patient is experiencing\" name=\"symptom\"            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ required=\"true\"&gt;&lt;/string&gt;                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"What part of the body the symptom is affecting\"                   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/lowercase\" name=\"affected_area\" required=\"true\"&gt;&lt;/string&gt;                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;/object&gt;                                                                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;/list&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;list description=\"Medications the patient is currently taking and their response\"         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ name=\"current_meds\" required=\"true\"&gt;                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;object required=\"true\"&gt;                                                                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"Name of the medication the patient is taking\"                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/uppercase\" name=\"medication\" required=\"true\"&gt;&lt;/string&gt;                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"How the patient is responding to the medication\" name=\"response\"  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ required=\"true\"&gt;&lt;/string&gt;                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;/object&gt;                                                                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;/list&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;string description=\"Any other information that is relevant to the patient's health;       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ something that doesn't fit into the other categories.\" format=\"guardrails/lowercase;         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ guardrails/one_line\" name=\"miscellaneous\" required=\"true\"&gt;&lt;/string&gt;                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;/output&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ ONLY return a valid JSON object (no other text is necessary), where the key of the field in  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ JSON is the `name` attribute of the corresponding XML, and the value is of the type          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ specified by the corresponding XML's tag. The JSON MUST conform to the XML format, including │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ any types and format requests e.g. requests for lists, objects and specific types. Be        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ correct and concise.                                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Here are examples of simple (XML, JSON) pairs that show the expected behavior:               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE',        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 'STRING TWO', etc.]}`                                                                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ name=\"index\" format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index':     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 1}}`                                                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └──────┴──────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"gender\": \"female\",                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"age\": 152,                                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"symptoms\": [                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"chronic macular rash\",                                                          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"face\"                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"itchy\",                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"beard\"                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"flaky\",                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"eyebrows\"                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"slightly scaly\",                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"nares\"                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         }                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"current_meds\": [                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"medication\": \"OTC steroid cream\",                                                          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"response\": \"moderate\"                                                                      │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         }                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"miscellaneous\": \"patient also suffers from diabetes\"                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'gender': 'female',                                                                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'age': 100,                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'symptoms': [                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'chronic macular rash', 'affected_area': 'face'},                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'itchy', 'affected_area': 'beard'},                                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'flaky', 'affected_area': 'eyebrows'},                                              │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'slightly scaly', 'affected_area': 'nares'}                                         │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'current_meds': [                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'medication': 'OTC STEROID CREAM', 'response': 'moderate'}                                     │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'miscellaneous': 'patient also suffers from diabetes'                                               │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />

As you can see here, the outputs in both examples match. The only difference is that, in the streaming example, the outputs are returned as soon as they are received and validated by Guardrails. In the non-streaming example, the outputs are returned only after the entire request has been processed by the API. In other words, when streaming is enabled, the API returns the outputs as soon as they are ready, rather than waiting for the entire request to be processed.


### 2. For unstructured text output


#### Define the prompt and Guard object with validators



```python
from guardrails.hub import UpperCase, OneLine

prompt = """
Generate a short description of large language models. Each new sentence should be on another line.
"""

guard = gd.Guard.for_string(
    validators=[
        UpperCase(on_fail="fix"),
        OneLine(on_fail="fix"),
    ],
    description="testmeout",
    messages=[{"role": "user", "content": prompt}],
)
```

#### Example 1: No streaming

By default, the `stream` parameter is set to `False`



```python
# Wrap the litellm OpenAI API call with the `guard` object
raw, validated, *rest = guard(
    model="gpt-3.5-turbo",
    max_tokens=50,
    temperature=0.1,
)

# Print the raw and validated outputs
print(f"Raw output:\n{raw}")
print(f"Validated output:\n{validated}")
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "/Users/dtam/dev/guardrails/guardrails/validator_service/__init__.py:85: UserWarning: Could not obtain an event loop. Falling back to synchronous validation.<br />      warnings.warn(<br /><br /><br /><br /><br /><pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Raw output:<br />Large language models are advanced artificial intelligence systems that can generate human-like text. <br />These models are trained on vast amounts of data to understand and mimic natural language patterns. <br />They have the ability to generate coherent and contextually relevant responses to prompts or questions<br /></pre><br />```<br /><br /><br /><br /><br /><pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Validated output:<br />LARGE LANGUAGE MODELS ARE ADVANCED ARTIFICIAL INTELLIGENCE SYSTEMS THAT CAN GENERATE HUMAN-LIKE TEXT. <br /></pre>"}} />

#### Example 2: With streaming

Set the `stream` parameter to `True`



```python
# Wrap the litellm OpenAI API call with the `guard` object
fragment_generator = guard(
    model="gpt-3.5-turbo",
    max_tokens=50,
    temperature=0.1,
    stream=True,
)

for op in fragment_generator:
    clear_output(wait=True)
    print(op)
    time.sleep(0.1)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">ValidationOutcome</span><span style=\"font-weight: bold\">(</span><br />    <span style=\"color: #808000; text-decoration-color: #808000\">call_id</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'14491466672'</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">raw_llm_output</span>=<span style=\"color: #008000; text-decoration-color: #008000\">' or'</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">validation_summaries</span>=<span style=\"font-weight: bold\">[]</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">validated_output</span>=<span style=\"color: #008000; text-decoration-color: #008000\">' HEY HAVE THE ABILITY TO GENERATE COHERENT AND CONTEXTUALLY RELEVANT RESPONSES TO PROMPTS </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">OR'</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">reask</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">validation_passed</span>=<span style=\"color: #ff0000; text-decoration-color: #ff0000; font-style: italic\">False</span>,<br />    <span style=\"color: #808000; text-decoration-color: #808000\">error</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span><br /><span style=\"font-weight: bold\">)</span><br /></pre>"}} />


```python
# See guard history
print(guard.history.last.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />└── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                      </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │ user │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Generate a short description of large language models. Each new sentence should be on        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ another line.                                                                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └──────┴──────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ Large language models are advanced artificial intelligence systems that can generate human-like text.   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ These models are trained on vast amounts of text data to understand and mimic human language patterns.  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ They have the ability to generate coherent and contextually relevant responses to prompts or            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ 'LARGE LANGUAGE MODELS ARE ADVANCED ARTIFICIAL INTELLIGENCE SYSTEMS THAT CAN GENERATE HUMAN-LIKE TEXT.  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ HEY HAVE THE ABILITY TO GENERATE COHERENT AND CONTEXTUALLY RELEVANT RESPONSES TO PROMPTS OR'            │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />

As you can see, the outputs in both examples match. The only difference is that, in the streaming example, the outputs are returned as soon as they are received and validated by Guardrails. In the non-streaming example, the outputs are returned only after the entire request has been processed by the API. In other words, when streaming is enabled, the API returns the outputs as soon as they are ready, rather than waiting for the entire request to be processed.
