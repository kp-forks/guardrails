import CodeOutputBlock from '../../code-output-block.jsx';

```bash
guardrails hub install hub://guardrails/similar_to_document --quiet
```

<CodeOutputBlock lang="bash">

```
    Installing hub://guardrails/similar_to_document...
    ✅Successfully installed guardrails/similar_to_document version 0.0.0!
    
    
```

</CodeOutputBlock>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->

# Summarize text accurately

:::note
    To download this example as a Jupyter notebook, click [here](https://github.com/ShreyaR/guardrails/blob/main/docs/src/examples/text_summarization_quality.ipynb).
:::

In this example, we will use Guardrails in the summarization of a text document. We will check whether the summarized document has a high semantic similarity with the original document.

## Objective

Summarize a text document and check whether the summarized document has a high semantic similarity with the original document.

## Step 0: Setup

In order to run this example, you will need to install the `numpy` package. You can do so by running the following commands:


```bash
pip install numpy -q
```

## Step 1: Create the RAIL Spec

Ordinarily, we would create an RAIL spec in a separate file. For the purposes of this example, we will create the spec in this notebook as a string following the RAIL syntax. For more information on RAIL, see the [RAIL documentation](/docs/how_to_guides/rail).  We will also show the same RAIL spec in a code-first format using a Pydantic model.

In this RAIL spec, we:

1. Create an `output` schema that returns a single key-value pair. The key should be 'summary', and the value should be the summary of the given document.

First let's open our document:


```python
with open("data/article1.txt", "r") as file:
    document = file.read()
    file.seek(0)
    content = "".join(line.strip() for line in file.readlines())
```

Next we can define our RAIL spec either as a XML string:


```python
from string import Template

rail_str = Template(
    """
<rail version="0.1">

<output>
    <string
        name="summary"
        description="Summarize the given document faithfully."
        format="similar-to-document: {${document}}, 0.60"
        on-fail-similar-to-document="filter" 
    />
</output>
<messages>
<message role="user">
Summarize the following document:

${document}

${gr.complete_xml_suffix}
</message>
</messages>
</rail>
"""
).safe_substitute(document=document)
```

Or as a Pydantic model:


```python
from pydantic import BaseModel, Field

from guardrails.hub import SimilarToDocument

prompt = """
Summarize the following document:

${document}

${gr.complete_xml_suffix}
"""


class DocumentSummary(BaseModel):
    summary: str = Field(
        description="Summarize the given document faithfully.",
        validators=[
            SimilarToDocument(document=f"'{content}'", threshold=0.60, on_fail="filter")
        ],
    )
```

<CodeOutputBlock lang="python">

```
    Loading the model all-MiniLM-L6-v2. This may take a while...
```

</CodeOutputBlock>

:::note

    In order to ensure the summary is similar to the document, we use `similar-to-document` as the validator. This validator embeds the document and the summary and checks whether the cosine similarity between the two embeddings is above a threshold.

:::

## Step 2: Create a `Guard` object with the RAIL Spec

We create a `gd.Guard` object that will check, validate and correct the output of the LLM. This object:

1. Enforces the quality criteria specified in the RAIL spec.
2. Takes corrective action when the quality criteria are not met.
3. Compiles the schema and type info from the RAIL spec and adds it to the prompt.


```python
from rich import print

import guardrails as gd
```

From our RAIL string:


```python
guard = gd.Guard.for_rail_string(rail_str)
```

Or from our Pydantic model:


```python
guard = gd.Guard.for_pydantic(output_class=DocumentSummary)
```

Here, `statement_to_be_translated` is the the statement and will be provided by the user at runtime.

## Step 3: Wrap the LLM API call with `Guard`

First, let's try translating a statement that doesn't have any profanity in it.


```python
# Set your OPENAI_API_KEY as an environment variable
# import os
# os.environ["OPENAI_API_KEY"] = "YOUR_API_KEY"

raw_llm_response, validated_response, *rest = guard(
    messages=[{"role": "user", "content": prompt}],
    prompt_params={"document": document},
    model="gpt-5-nano",
    max_tokens=2048,
    temperature=1,
)

print(f"Validated Output: {validated_response}")
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "/Users/calebcourier/Projects/guardrails/docs/.venv/lib/python3.12/site-packages/guardrails/validator_service/__init__.py:84: UserWarning: Could not obtain an event loop. Falling back to synchronous validation.<br />      warnings.warn(<br /><br /><br /><br /><br /><pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Validated Output: <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'summary'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'The document vests all legislative power in Congress, consisting of a Senate and </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">House. The House is elected every two years by the people of the states, with members required to be at least 25 </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">years old, seven years a citizen, and a resident of the state of election. Representation and direct taxation are </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">apportioned by population, counting free persons and including three fifths of enslaved persons; a census is to be </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">taken within three years after the first meeting and every ten years thereafter. The number of Representatives </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">shall not exceed one per thirty thousand, but each state must have at least one. An initial allocation to certain </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">states is provided until enumeration is done. Vacancies are filled by writs of election. The House chooses its </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">Speaker and officers and has the sole power of impeachment; the Electors in each state must meet qualifications for</span><br /><span style=\"color: #008000; text-decoration-color: #008000\">electors of the most numerous branch of the state legislature.'</span><span style=\"font-weight: bold\">}</span><br /></pre>"}} />

We can see the prompt that was sent to the LLM:


```python
print(guard.history.last.iterations.last.inputs.messages[0]["content"])
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><br />Summarize the following document:<br /><br />Section. <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>.<br />All legislative Powers herein granted shall be vested in a Congress of the United States, which shall consist of a <br />Senate and House of Representatives.<br /><br />Section. <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span>.<br />The House of Representatives shall be composed of Members chosen every second Year by the People of the several <br />States, and the Electors in each State shall have the Qualifications requisite for Electors of the most numerous <br />Branch of the State Legislature.<br /><br />No Person shall be a Representative who shall not have attained to the Age of twenty five Years, and been seven <br />Years a Citizen of the United States, and who shall not, when elected, be an Inhabitant of that State in which he <br />shall be chosen.<br /><br />Representatives and direct Taxes shall be apportioned among the several States which may be included within this <br />Union, according to their respective Numbers, which shall be determined by adding to the whole Number of free <br />Persons, including those bound to Service for a Term of Years, and excluding Indians not taxed, three fifths of all<br />other Persons. The actual Enumeration shall be made within three Years after the first Meeting of the Congress of <br />the United States, and within every subsequent Term of ten Years, in such Manner as they shall by Law direct. The <br />Number of Representatives shall not exceed one for every thirty Thousand, but each State shall have at Least one <br />Representative; and until such enumeration shall be made, the State of New Hampshire shall be entitled to chuse <br />three, Massachusetts eight, Rhode-Island and Providence Plantations one, Connecticut five, New-York six, New Jersey<br />four, Pennsylvania eight, Delaware one, Maryland six, Virginia ten, North Carolina five, South Carolina five, and <br />Georgia three.<br /><br />When vacancies happen in the Representation from any State, the Executive Authority thereof shall issue Writs of <br />Election to fill such Vacancies.<br /><br />The House of Representatives shall chuse their Speaker and other Officers; and shall have the sole Power of <br />Impeachment.<br /><br /><br />Given below is XML that describes the information to extract from this document and the tags to extract it into.<br /><br /><span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">output</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">  &lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">description</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"Summarize the given document faithfully.\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"guardrails/similar_to_document: 'Section. </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">1.All legislative Powers herein granted shall be vested in a Congress of the United States, which shall consist of </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">a Senate and House of Representatives.Section. 2.The House of Representatives shall be composed of Members chosen </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">every second Year by the People of the several States, and the Electors in each State shall have the Qualifications</span><br /><span style=\"color: #008000; text-decoration-color: #008000\">requisite for Electors of the most numerous Branch of the State Legislature.No Person shall be a Representative who</span><br /><span style=\"color: #008000; text-decoration-color: #008000\">shall not have attained to the Age of twenty five Years, and been seven Years a Citizen of the United States, and </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">who shall not, when elected, be an Inhabitant of that State in which he shall be chosen.Representatives and direct </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">Taxes shall be apportioned among the several States which may be included within this Union, according to their </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">respective Numbers, which shall be determined by adding to the whole Number of free Persons, including those bound </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">to Service for a Term of Years, and excluding Indians not taxed, three fifths of all other Persons. The actual </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">Enumeration shall be made within three Years after the first Meeting of the Congress of the United States, and </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">within every subsequent Term of ten Years, in such Manner as they shall by Law direct. The Number of </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">Representatives shall not exceed one for every thirty Thousand, but each State shall have at Least one </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">Representative; and until such enumeration shall be made, the State of New Hampshire shall be entitled to chuse </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">three, Massachusetts eight, Rhode-Island and Providence Plantations one, Connecticut five, New-York six, New Jersey</span><br /><span style=\"color: #008000; text-decoration-color: #008000\">four, Pennsylvania eight, Delaware one, Maryland six, Virginia ten, North Carolina five, South Carolina five, and </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">Georgia three.When vacancies happen in the Representation from any State, the Executive Authority thereof shall </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">issue Writs of Election to fill such Vacancies.The House of Representatives shall chuse their Speaker and other </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">Officers; and shall have the sole Power of Impeachment.' 0.6 all-MiniLM-L6-v2\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"summary\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><br /><span style=\"color: #808000; text-decoration-color: #808000\">required</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"true\"</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">string</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">output</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><br /><span style=\"color: #000000; text-decoration-color: #000000\">ONLY return a valid JSON object </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #000000; text-decoration-color: #000000\">no other text is necessary</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"color: #000000; text-decoration-color: #000000\">, where the key of the field in JSON is the `name` </span><br /><span style=\"color: #000000; text-decoration-color: #000000\">attribute of the corresponding XML, and the value is of the type specified by the corresponding XML's tag. The JSON</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">MUST conform to the XML format, including any types and format requests e.g. requests for lists, objects and </span><br /><span style=\"color: #000000; text-decoration-color: #000000\">specific types. Be correct and concise. If you are unsure anywhere, enter `null`.</span><br /><br /><span style=\"color: #000000; text-decoration-color: #000000\">Here are examples of simple </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #000000; text-decoration-color: #000000\">XML, JSON</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"color: #000000; text-decoration-color: #000000\"> pairs that show the expected behavior:</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">- `&lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'foo'</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'two-words lower-case'</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;` =&gt; `</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'foo'</span><span style=\"color: #000000; text-decoration-color: #000000\">: </span><span style=\"color: #008000; text-decoration-color: #008000\">'example one'</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">}</span><span style=\"color: #000000; text-decoration-color: #000000\">`</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">- `&lt;list </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'bar'</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'upper-case'</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">list</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;` =&gt; `</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">\"bar\"</span><span style=\"color: #000000; text-decoration-color: #000000\">: </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'STRING ONE'</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008000; text-decoration-color: #008000\">'STRING TWO'</span><span style=\"color: #000000; text-decoration-color: #000000\">, etc.</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">]}</span><span style=\"color: #000000; text-decoration-color: #000000\">`</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">- `&lt;object </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'baz'</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"foo\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"capitalize two-words\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;integer </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"index\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"1-indexed\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><br /><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">object</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;` =</span><span style=\"font-weight: bold\">&gt;</span> `<span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'baz'</span>: <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'foo'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'Some String'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'index'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">}}</span>`<br /><br /><br /></pre>"}} />

In order to see a detailed look into the logs of the `Guard` object, we can print the `Guard` state history:


```python
print(guard.history.last.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />└── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                      </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │ user │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Summarize the following document:                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Section. 1.                                                                                  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ All legislative Powers herein granted shall be vested in a Congress of the United States,    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ which shall consist of a Senate and House of Representatives.                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Section. 2.                                                                                  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ The House of Representatives shall be composed of Members chosen every second Year by the    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ People of the several States, and the Electors in each State shall have the Qualifications   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ requisite for Electors of the most numerous Branch of the State Legislature.                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ No Person shall be a Representative who shall not have attained to the Age of twenty five    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Years, and been seven Years a Citizen of the United States, and who shall not, when elected, │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ be an Inhabitant of that State in which he shall be chosen.                                  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Representatives and direct Taxes shall be apportioned among the several States which may be  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ included within this Union, according to their respective Numbers, which shall be determined │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ by adding to the whole Number of free Persons, including those bound to Service for a Term   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ of Years, and excluding Indians not taxed, three fifths of all other Persons. The actual     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Enumeration shall be made within three Years after the first Meeting of the Congress of the  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ United States, and within every subsequent Term of ten Years, in such Manner as they shall   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ by Law direct. The Number of Representatives shall not exceed one for every thirty Thousand, │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ but each State shall have at Least one Representative; and until such enumeration shall be   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ made, the State of New Hampshire shall be entitled to chuse three, Massachusetts eight,      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Rhode-Island and Providence Plantations one, Connecticut five, New-York six, New Jersey      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ four, Pennsylvania eight, Delaware one, Maryland six, Virginia ten, North Carolina five,     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ South Carolina five, and Georgia three.                                                      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ When vacancies happen in the Representation from any State, the Executive Authority thereof  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ shall issue Writs of Election to fill such Vacancies.                                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ The House of Representatives shall chuse their Speaker and other Officers; and shall have    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ the sole Power of Impeachment.                                                               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Given below is XML that describes the information to extract from this document and the tags │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ to extract it into.                                                                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;output&gt;                                                                                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;string description=\"Summarize the given document faithfully.\"                             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/similar_to_document: 'Section. 1.All legislative Powers herein granted    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ shall be vested in a Congress of the United States, which shall consist of a Senate and      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ House of Representatives.Section. 2.The House of Representatives shall be composed of        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Members chosen every second Year by the People of the several States, and the Electors in    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ each State shall have the Qualifications requisite for Electors of the most numerous Branch  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ of the State Legislature.No Person shall be a Representative who shall not have attained to  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ the Age of twenty five Years, and been seven Years a Citizen of the United States, and who   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ shall not, when elected, be an Inhabitant of that State in which he shall be                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ chosen.Representatives and direct Taxes shall be apportioned among the several States which  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ may be included within this Union, according to their respective Numbers, which shall be     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ determined by adding to the whole Number of free Persons, including those bound to Service   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ for a Term of Years, and excluding Indians not taxed, three fifths of all other Persons. The │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ actual Enumeration shall be made within three Years after the first Meeting of the Congress  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ of the United States, and within every subsequent Term of ten Years, in such Manner as they  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ shall by Law direct. The Number of Representatives shall not exceed one for every thirty     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Thousand, but each State shall have at Least one Representative; and until such enumeration  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ shall be made, the State of New Hampshire shall be entitled to chuse three, Massachusetts    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ eight, Rhode-Island and Providence Plantations one, Connecticut five, New-York six, New      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Jersey four, Pennsylvania eight, Delaware one, Maryland six, Virginia ten, North Carolina    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ five, South Carolina five, and Georgia three.When vacancies happen in the Representation     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ from any State, the Executive Authority thereof shall issue Writs of Election to fill such   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Vacancies.The House of Representatives shall chuse their Speaker and other Officers; and     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ shall have the sole Power of Impeachment.' 0.6 all-MiniLM-L6-v2\" name=\"summary\"              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ required=\"true\"&gt;&lt;/string&gt;                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;/output&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ ONLY return a valid JSON object (no other text is necessary), where the key of the field in  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ JSON is the `name` attribute of the corresponding XML, and the value is of the type          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ specified by the corresponding XML's tag. The JSON MUST conform to the XML format, including │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ any types and format requests e.g. requests for lists, objects and specific types. Be        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ correct and concise. If you are unsure anywhere, enter `null`.                               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Here are examples of simple (XML, JSON) pairs that show the expected behavior:               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE',        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 'STRING TWO', etc.]}`                                                                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ name=\"index\" format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index':     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 1}}`                                                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └──────┴──────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ {\"summary\": \"The document vests all legislative power in Congress, consisting of a Senate and House.    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ The House is elected every two years by the people of the states, with members required to be at least  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ 25 years old, seven years a citizen, and a resident of the state of election. Representation and direct │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ taxation are apportioned by population, counting free persons and including three fifths of enslaved    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ persons; a census is to be taken within three years after the first meeting and every ten years         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ thereafter. The number of Representatives shall not exceed one per thirty thousand, but each state must │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ have at least one. An initial allocation to certain states is provided until enumeration is done.       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ Vacancies are filled by writs of election. The House chooses its Speaker and officers and has the sole  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ power of impeachment; the Electors in each state must meet qualifications for electors of the most      │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ numerous branch of the state legislature.\"}                                                             │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'summary': 'The document vests all legislative power in Congress, consisting of a Senate and House. │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ The House is elected every two years by the people of the states, with members required to be at least  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ 25 years old, seven years a citizen, and a resident of the state of election. Representation and direct │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ taxation are apportioned by population, counting free persons and including three fifths of enslaved    │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ persons; a census is to be taken within three years after the first meeting and every ten years         │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ thereafter. The number of Representatives shall not exceed one per thirty thousand, but each state must │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ have at least one. An initial allocation to certain states is provided until enumeration is done.       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ Vacancies are filled by writs of election. The House chooses its Speaker and officers and has the sole  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ power of impeachment; the Electors in each state must meet qualifications for electors of the most      │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ numerous branch of the state legislature.'                                                              │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />

The `guard` wrapper returns the raw_llm_respose (which is a simple string), and the validated and corrected output (which is a dictionary). We can see that the output is a dictionary with the correct schema and types.

Next, let's try using a smaller model, which is not going to be good at summarization. We can see that the output is filtered out.


```python
raw_llm_response, validated_response, *rest = guard(
    messages=[{"role": "user", "content": prompt}],
    prompt_params={"document": open("data/article1.txt", "r").read()},
    model="babbage-002",
    max_tokens=512,
    temperature=0,
)

print(f"Validated Output: {validated_response}")
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Validated Output: <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span><br /></pre>"}} />

We can see the step-wise history of the `Guard` object below:


```python
print(guard.history.last.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />├── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />│   │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                      </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │ user │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Summarize the following document:                                                            │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Section. 1.                                                                                  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ All legislative Powers herein granted shall be vested in a Congress of the United States,    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ which shall consist of a Senate and House of Representatives.                                │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Section. 2.                                                                                  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ The House of Representatives shall be composed of Members chosen every second Year by the    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ People of the several States, and the Electors in each State shall have the Qualifications   │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ requisite for Electors of the most numerous Branch of the State Legislature.                 │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ No Person shall be a Representative who shall not have attained to the Age of twenty five    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Years, and been seven Years a Citizen of the United States, and who shall not, when elected, │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ be an Inhabitant of that State in which he shall be chosen.                                  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Representatives and direct Taxes shall be apportioned among the several States which may be  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ included within this Union, according to their respective Numbers, which shall be determined │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ by adding to the whole Number of free Persons, including those bound to Service for a Term   │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ of Years, and excluding Indians not taxed, three fifths of all other Persons. The actual     │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Enumeration shall be made within three Years after the first Meeting of the Congress of the  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ United States, and within every subsequent Term of ten Years, in such Manner as they shall   │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ by Law direct. The Number of Representatives shall not exceed one for every thirty Thousand, │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ but each State shall have at Least one Representative; and until such enumeration shall be   │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ made, the State of New Hampshire shall be entitled to chuse three, Massachusetts eight,      │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Rhode-Island and Providence Plantations one, Connecticut five, New-York six, New Jersey      │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ four, Pennsylvania eight, Delaware one, Maryland six, Virginia ten, North Carolina five,     │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ South Carolina five, and Georgia three.                                                      │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ When vacancies happen in the Representation from any State, the Executive Authority thereof  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ shall issue Writs of Election to fill such Vacancies.                                        │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ The House of Representatives shall chuse their Speaker and other Officers; and shall have    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ the sole Power of Impeachment.                                                               │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Given below is XML that describes the information to extract from this document and the tags │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ to extract it into.                                                                          │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;output&gt;                                                                                     │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;string description=\"Summarize the given document faithfully.\"                             │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/similar_to_document: 'Section. 1.All legislative Powers herein granted    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ shall be vested in a Congress of the United States, which shall consist of a Senate and      │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ House of Representatives.Section. 2.The House of Representatives shall be composed of        │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Members chosen every second Year by the People of the several States, and the Electors in    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ each State shall have the Qualifications requisite for Electors of the most numerous Branch  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ of the State Legislature.No Person shall be a Representative who shall not have attained to  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ the Age of twenty five Years, and been seven Years a Citizen of the United States, and who   │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ shall not, when elected, be an Inhabitant of that State in which he shall be                 │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ chosen.Representatives and direct Taxes shall be apportioned among the several States which  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ may be included within this Union, according to their respective Numbers, which shall be     │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ determined by adding to the whole Number of free Persons, including those bound to Service   │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ for a Term of Years, and excluding Indians not taxed, three fifths of all other Persons. The │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ actual Enumeration shall be made within three Years after the first Meeting of the Congress  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ of the United States, and within every subsequent Term of ten Years, in such Manner as they  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ shall by Law direct. The Number of Representatives shall not exceed one for every thirty     │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Thousand, but each State shall have at Least one Representative; and until such enumeration  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ shall be made, the State of New Hampshire shall be entitled to chuse three, Massachusetts    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ eight, Rhode-Island and Providence Plantations one, Connecticut five, New-York six, New      │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Jersey four, Pennsylvania eight, Delaware one, Maryland six, Virginia ten, North Carolina    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ five, South Carolina five, and Georgia three.When vacancies happen in the Representation     │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ from any State, the Executive Authority thereof shall issue Writs of Election to fill such   │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Vacancies.The House of Representatives shall chuse their Speaker and other Officers; and     │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ shall have the sole Power of Impeachment.' 0.6 all-MiniLM-L6-v2\" name=\"summary\"              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ required=\"true\"&gt;&lt;/string&gt;                                                                    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;/output&gt;                                                                                    │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ ONLY return a valid JSON object (no other text is necessary), where the key of the field in  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ JSON is the `name` attribute of the corresponding XML, and the value is of the type          │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ specified by the corresponding XML's tag. The JSON MUST conform to the XML format, including │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ any types and format requests e.g. requests for lists, objects and specific types. Be        │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ correct and concise. If you are unsure anywhere, enter `null`.                               │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ Here are examples of simple (XML, JSON) pairs that show the expected behavior:               │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`          │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE',        │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ 'STRING TWO', etc.]}`                                                                        │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer            │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ name=\"index\" format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index':     │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ 1}}`                                                                                         │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ └──────┴──────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│ If you are unsure about anything, please ask.                                                           │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│ None                                                                                                    │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br />└── ╭────────────────────────────────────────────────── Step 1 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\">   Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                    </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │ system │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ You are a helpful assistant only capable of communicating with valid JSON, and no other    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ text.                                                                                      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ ONLY return a valid JSON object (no other text is necessary), where the key of the field   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ in JSON is the `name` attribute of the corresponding XML, and the value is of the type     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ specified by the corresponding XML's tag. The JSON MUST conform to the XML format,         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ including any types and format requests e.g. requests for lists, objects and specific      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ types. Be correct and concise. If you are unsure anywhere, enter `null`.                   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Here are examples of simple (XML, JSON) pairs that show the expected behavior:             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE',      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ 'STRING TWO', etc.]}`                                                                      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ name=\"index\" format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index':   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ 1}}`                                                                                       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ├────────┼────────────────────────────────────────────────────────────────────────────────────────────┤ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │   user │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ I was given the following response, which was not parseable as JSON.                       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ \"If you are unsure about anything, please ask.\"                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Help me correct this by making it valid JSON.                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Given below is XML that describes the information to extract from this document and the    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ tags to extract it into.                                                                   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ &lt;output&gt;                                                                                   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │   &lt;string description=\"Summarize the given document faithfully.\"                           │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ format=\"guardrails/similar_to_document: 'Section. 1.All legislative Powers herein granted  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ shall be vested in a Congress of the United States, which shall consist of a Senate and    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ House of Representatives.Section. 2.The House of Representatives shall be composed of      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Members chosen every second Year by the People of the several States, and the Electors in  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ each State shall have the Qualifications requisite for Electors of the most numerous       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Branch of the State Legislature.No Person shall be a Representative who shall not have     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ attained to the Age of twenty five Years, and been seven Years a Citizen of the United     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ States, and who shall not, when elected, be an Inhabitant of that State in which he shall  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ be chosen.Representatives and direct Taxes shall be apportioned among the several States   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ which may be included within this Union, according to their respective Numbers, which      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ shall be determined by adding to the whole Number of free Persons, including those bound   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ to Service for a Term of Years, and excluding Indians not taxed, three fifths of all other │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Persons. The actual Enumeration shall be made within three Years after the first Meeting   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ of the Congress of the United States, and within every subsequent Term of ten Years, in    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ such Manner as they shall by Law direct. The Number of Representatives shall not exceed    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ one for every thirty Thousand, but each State shall have at Least one Representative; and  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ until such enumeration shall be made, the State of New Hampshire shall be entitled to      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ chuse three, Massachusetts eight, Rhode-Island and Providence Plantations one, Connecticut │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ five, New-York six, New Jersey four, Pennsylvania eight, Delaware one, Maryland six,       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Virginia ten, North Carolina five, South Carolina five, and Georgia three.When vacancies   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ happen in the Representation from any State, the Executive Authority thereof shall issue   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Writs of Election to fill such Vacancies.The House of Representatives shall chuse their    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Speaker and other Officers; and shall have the sole Power of Impeachment.' 0.6             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ all-MiniLM-L6-v2\" name=\"summary\" required=\"true\"&gt;&lt;/string&gt;                                 │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ &lt;/output&gt;                                                                                  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ ONLY return a valid JSON object (no other text is necessary), where the key of the field   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ in JSON is the `name` attribute of the corresponding XML, and the value is of the type     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ specified by the corresponding XML's tag. The JSON MUST conform to the XML format,         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ including any types and format requests e.g. requests for lists, objects and specific      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ types. Be correct and concise. If you are unsure anywhere, enter `null`.                   │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └────────┴────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt;                                                                      │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ None                                                                                                    │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />
