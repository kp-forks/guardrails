import CodeOutputBlock from '../../docusaurus/code-output-block.jsx';

```bash
guardrails hub install hub://guardrails/valid_length --quiet
guardrails hub install hub://guardrails/two_words --quiet
guardrails hub install hub://guardrails/valid_range --quiet
```

<CodeOutputBlock lang="bash">

```
    Installing hub://guardrails/valid_length...
    ✅Successfully installed guardrails/valid_length!
    
    
    Installing hub://guardrails/two_words...
    ✅Successfully installed guardrails/two_words!
    
    
    Installing hub://guardrails/valid_range...
    ✅Successfully installed guardrails/valid_range!
    
    
```

</CodeOutputBlock>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->

# Generating Structured Synthetic Data

!!! note
    To download this tutorial as a Jupyter notebook, click [here](https://github.com/ShreyaR/guardrails/blob/main/docs/examples/generate_structured_data.ipynb).

In this example, we'll generate structured dummy data for a `pandas` dataframe.

We make the assumption that:

1. We don't need any external libraries that are not already installed in the environment.
2. We are able to execute the code in the environment.

## Objective

We want to generate structured synthetic data, where each column has a specific data type. All rows in the dataset must respect the column data types. Additionally, we have some more constraints we want the data to respect:

1. There should be exactly 10 rows in the dataset.
2. Each user should have a first name and a last name.
3. The number of orders associated with each user should be between 0 and 50.
4. Each user should have a most recent order date.

## Step 1: Generating Pydantic `RAIL` Spec


```python
from pydantic import BaseModel, Field
from guardrails.hub import ValidLength, TwoWords, ValidRange
from typing import List

prompt = """
Generate a dataset of fake user orders. Each row of the dataset should be valid.

${gr.complete_xml_suffix}
"""


class Order(BaseModel):
    user_id: str = Field(description="The user's id.")
    user_name: str = Field(
        description="The user's first name and last name",
        validators=[TwoWords(on_fail="noop")],
    )
    num_orders: int = Field(
        description="The number of orders the user has placed",
        validators=[ValidRange(0, 50, on_fail="noop")],
    )


class Orders(BaseModel):
    user_orders: List[Order] = Field(
        description="Generate a list of user, and how many orders they have placed in the past.",
        validators=[ValidLength(10, 10, on_fail="noop")],
    )
```

## Step 2: Create a `Guard` object with the RAIL Spec

We create a `gd.Guard` object that will check, validate and correct the generated code. This object:

1. Enforces the quality criteria specified in the RAIL spec (i.e. bug free code).
2. Takes corrective action when the quality criteria are not met (i.e. reasking the LLM).
3. Compiles the schema and type info from the RAIL spec and adds it to the prompt.


```python
import guardrails as gd

from rich import print
```


```python
guard = gd.Guard.for_pydantic(output_class=Orders)
```

## Step 3: Wrap the LLM API call with `Guard`


```python
# Add your OPENAI_API_KEY as an environment variable if it's not already set
# import os
# os.environ["OPENAI_API_KEY"] = "YOUR_API_KEY"

res = guard(
    model="gpt-4o",
    messages=[{"role": "user", "content": prompt}],
    max_tokens=2048,
    temperature=0,
)
```

<CodeOutputBlock lang="python">

```
    /Users/dtam/dev/guardrails/guardrails/validator_service/__init__.py:85: UserWarning: Could not obtain an event loop. Falling back to synchronous validation.
      warnings.warn(
```

</CodeOutputBlock>

The `Guard` object compiles the output schema and adds it to the prompt. We can see the final prompt below:


```python
print(guard.history.last.iterations.last.inputs.messages[0]["content"])
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><br />Generate a dataset of fake user orders. Each row of the dataset should be valid.<br /><br /><br />Given below is XML that describes the information to extract from this document and the tags to extract it into.<br /><br /><span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">output</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">  &lt;list </span><span style=\"color: #808000; text-decoration-color: #808000\">description</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"Generate a list of user, and how many orders they have placed in the past.\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><br /><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"guardrails/valid_length: 10 10\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"user_orders\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">required</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"true\"</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">    &lt;object </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"guardrails/valid_length: 10 10\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">required</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"true\"</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">      &lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">description</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"The user's id.\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">required</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"true\"</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">string</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">      &lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">description</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"The user's first name and last name\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"guardrails/two_words\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><br /><span style=\"color: #808000; text-decoration-color: #808000\">required</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"true\"</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">string</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">      &lt;integer </span><span style=\"color: #808000; text-decoration-color: #808000\">description</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"The number of orders the user has placed\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"guardrails/valid_range: 0 50\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><br /><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">required</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"true\"</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">integer</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">    &lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">object</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">  &lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">list</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">output</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;</span><br /><br /><span style=\"color: #000000; text-decoration-color: #000000\">ONLY return a valid JSON object </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #000000; text-decoration-color: #000000\">no other text is necessary</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"color: #000000; text-decoration-color: #000000\">, where the key of the field in JSON is the `name` </span><br /><span style=\"color: #000000; text-decoration-color: #000000\">attribute of the corresponding XML, and the value is of the type specified by the corresponding XML's tag. The JSON</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">MUST conform to the XML format, including any types and format requests e.g. requests for lists, objects and </span><br /><span style=\"color: #000000; text-decoration-color: #000000\">specific types. Be correct and concise. If you are unsure anywhere, enter `null`.</span><br /><br /><span style=\"color: #000000; text-decoration-color: #000000\">Here are examples of simple </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #000000; text-decoration-color: #000000\">XML, JSON</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"color: #000000; text-decoration-color: #000000\"> pairs that show the expected behavior:</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">- `&lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'foo'</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'two-words lower-case'</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;` =&gt; `</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'foo'</span><span style=\"color: #000000; text-decoration-color: #000000\">: </span><span style=\"color: #008000; text-decoration-color: #008000\">'example one'</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">}</span><span style=\"color: #000000; text-decoration-color: #000000\">`</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">- `&lt;list </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'bar'</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'upper-case'</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">list</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;` =&gt; `</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">\"bar\"</span><span style=\"color: #000000; text-decoration-color: #000000\">: </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'STRING ONE'</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008000; text-decoration-color: #008000\">'STRING TWO'</span><span style=\"color: #000000; text-decoration-color: #000000\">, etc.</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">]}</span><span style=\"color: #000000; text-decoration-color: #000000\">`</span><br /><span style=\"color: #000000; text-decoration-color: #000000\">- `&lt;object </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">'baz'</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;string </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"foo\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"capitalize two-words\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;integer </span><span style=\"color: #808000; text-decoration-color: #808000\">name</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"index\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #808000; text-decoration-color: #808000\">format</span><span style=\"color: #000000; text-decoration-color: #000000\">=</span><span style=\"color: #008000; text-decoration-color: #008000\">\"1-indexed\"</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><br /><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;&lt;</span><span style=\"color: #800080; text-decoration-color: #800080\">/</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff\">object</span><span style=\"color: #000000; text-decoration-color: #000000\">&gt;` =</span><span style=\"font-weight: bold\">&gt;</span> `<span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'baz'</span>: <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'foo'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'Some String'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'index'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">}}</span>`<br /><br /><br /></pre>"}} />


```python
print(res.raw_llm_output)
res.validated_output
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">```json<br /><span style=\"font-weight: bold\">{</span><br />  <span style=\"color: #008000; text-decoration-color: #008000\">\"user_orders\"</span>: <span style=\"font-weight: bold\">[</span><br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U001\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"John Doe\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U002\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Jane Smith\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U003\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Alice Johnson\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U004\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Bob Brown\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U005\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Charlie Davis\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">30</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U006\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Emily White\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U007\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Frank Harris\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U008\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Grace Lee\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U009\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Henry Clark\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">22</span><br />    <span style=\"font-weight: bold\">}</span>,<br />    <span style=\"font-weight: bold\">{</span><br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_id\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"U010\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"user_name\"</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"Ivy Walker\"</span>,<br />      <span style=\"color: #008000; text-decoration-color: #008000\">\"num_orders\"</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span><br />    <span style=\"font-weight: bold\">}</span><br />  <span style=\"font-weight: bold\">]</span><br /><span style=\"font-weight: bold\">}</span><br />```<br /></pre><br />```<br /><br /><br /><br /><br /><br />    {'user_orders': [{'user_id': 'U001',<br />       'user_name': 'John Doe',<br />       'num_orders': 12},<br />      {'user_id': 'U002', 'user_name': 'Jane Smith', 'num_orders': 8},<br />      {'user_id': 'U003', 'user_name': 'Alice Johnson', 'num_orders': 25},<br />      {'user_id': 'U004', 'user_name': 'Bob Brown', 'num_orders': 15},<br />      {'user_id': 'U005', 'user_name': 'Charlie Davis', 'num_orders': 30},<br />      {'user_id': 'U006', 'user_name': 'Emily White', 'num_orders': 5},<br />      {'user_id': 'U007', 'user_name': 'Frank Harris', 'num_orders': 20},<br />      {'user_id': 'U008', 'user_name': 'Grace Lee', 'num_orders': 18},<br />      {'user_id': 'U009', 'user_name': 'Henry Clark', 'num_orders': 22},<br />      {'user_id': 'U010', 'user_name': 'Ivy Walker', 'num_orders': 10}]}"}} />

Running the cell above returns:
1. The raw LLM text output as a single string.
2. A dictionary where the key `user_orders` key contains a list of dictionaries, where each dictionary represents a row in the dataframe.


```python
print(guard.history.last.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />└── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                      </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │ user │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Generate a dataset of fake user orders. Each row of the dataset should be valid.             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Given below is XML that describes the information to extract from this document and the tags │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ to extract it into.                                                                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;output&gt;                                                                                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;list description=\"Generate a list of user, and how many orders they have placed in the    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ past.\" format=\"guardrails/valid_length: 10 10\" name=\"user_orders\" required=\"true\"&gt;           │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;object format=\"guardrails/valid_length: 10 10\" required=\"true\"&gt;                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"The user's id.\" name=\"user_id\" required=\"true\"&gt;&lt;/string&gt;          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"The user's first name and last name\"                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/two_words\" name=\"user_name\" required=\"true\"&gt;&lt;/string&gt;                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;integer description=\"The number of orders the user has placed\"                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/valid_range: 0 50\" name=\"num_orders\" required=\"true\"&gt;&lt;/integer&gt;           │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;/object&gt;                                                                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;/list&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;/output&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ ONLY return a valid JSON object (no other text is necessary), where the key of the field in  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ JSON is the `name` attribute of the corresponding XML, and the value is of the type          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ specified by the corresponding XML's tag. The JSON MUST conform to the XML format, including │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ any types and format requests e.g. requests for lists, objects and specific types. Be        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ correct and concise. If you are unsure anywhere, enter `null`.                               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Here are examples of simple (XML, JSON) pairs that show the expected behavior:               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE',        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 'STRING TWO', etc.]}`                                                                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ name=\"index\" format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index':     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 1}}`                                                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └──────┴──────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ ```json                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   \"user_orders\": [                                                                                      │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U001\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"John Doe\",                                                                          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 12                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U002\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Jane Smith\",                                                                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 8                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U003\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Alice Johnson\",                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 25                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U004\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Bob Brown\",                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 15                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U005\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Charlie Davis\",                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 30                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U006\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Emily White\",                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 5                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U007\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Frank Harris\",                                                                      │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 20                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U008\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Grace Lee\",                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 18                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U009\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Henry Clark\",                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 22                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_id\": \"U010\",                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"user_name\": \"Ivy Walker\",                                                                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"num_orders\": 10                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     }                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   ]                                                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ ```                                                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'user_orders': [                                                                                    │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U001', 'user_name': 'John Doe', 'num_orders': 12},                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U002', 'user_name': 'Jane Smith', 'num_orders': 8},                                │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U003', 'user_name': 'Alice Johnson', 'num_orders': 25},                            │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U004', 'user_name': 'Bob Brown', 'num_orders': 15},                                │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U005', 'user_name': 'Charlie Davis', 'num_orders': 30},                            │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U006', 'user_name': 'Emily White', 'num_orders': 5},                               │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U007', 'user_name': 'Frank Harris', 'num_orders': 20},                             │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U008', 'user_name': 'Grace Lee', 'num_orders': 18},                                │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U009', 'user_name': 'Henry Clark', 'num_orders': 22},                              │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 'U010', 'user_name': 'Ivy Walker', 'num_orders': 10}                                │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     ]                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />
