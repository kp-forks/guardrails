import CodeOutputBlock from '../../code-output-block.jsx';

Define our prompt

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->


```python
prompt = """
Generate a dataset of fake user orders. Each row of the dataset should be valid. The format should not be a list, it should be a JSON object.
${gr.complete_xml_suffix}

an example of output may look like this:
{
	"user_orders": [{                                                                                                   │ │
        "user_id": 1,
        "user_name": "John Mcdonald",
    	"num_orders": 6
    }]
}

"""
```

Install validators


```bash
guardrails hub install hub://guardrails/valid_length --quiet
guardrails hub install hub://guardrails/two_words --quiet
guardrails hub install hub://guardrails/valid_range --quiet
pip install cohere --quiet
```

<CodeOutputBlock lang="bash">

```
    Installing hub://guardrails/valid_length...
    ✅Successfully installed guardrails/valid_length!
    
    
    Installing hub://guardrails/two_words...
    ✅Successfully installed guardrails/two_words!
    
    
    Installing hub://guardrails/valid_range...
    ✅Successfully installed guardrails/valid_range!
    
    
```

</CodeOutputBlock>

Defined what our data should look like in pydantic

Note: 1-indexed is an example of passing non-validator instructions on a per field level via the `format` field.
It will throw a validator warning and is to be expected.


```python
from pydantic import BaseModel, Field
from guardrails.hub import ValidLength, TwoWords, ValidRange
from typing import List


class Order(BaseModel):
    user_id: int = Field(
        description="The user's id.", validators=[("1-indexed", "noop")]
    )
    user_name: str = Field(
        description="The user's first name and last name",
        validators=[TwoWords(on_fail="noop")],
    )

    num_orders: int = Field(
        description="The number of orders the user has placed",
        validators=[ValidRange(0, 50, on_fail="noop")],
    )


class Orders(BaseModel):
    user_orders: List[Order] = Field(
        description="Generate a list of users and how many orders they have placed in the past.",
        validators=[ValidLength(10, 10, on_fail="noop")],
    )
```

Set up the cohere client. In this notebook, we use an environment variable to pass the cohere API key through


```python
# Add your OPENAI_API_KEY as an environment variable if it's not already set
# import os
# os.environ["COHERE_API_KEY"] = "YOUR_COHERE_API_KEY"
```

Create the guard and prompt


```python
from rich import print
import guardrails as gd

guard = gd.Guard.for_pydantic(output_class=Orders)

raw_llm_response, validated_response, *rest = guard(
    messages=[{"role": "user", "content": prompt}],
    model="command-r-08-2024",
    max_tokens=1024,
    temperature=0.3,
)
```

<CodeOutputBlock lang="python">

```
    /Users/dtam/dev/guardrails/guardrails/validator_base.py:590: UserWarning: Validator with id 1-indexed was not found in the registry!  Ignoring...
      warn(f"Validator with id {name} was not found in the registry!  Ignoring...")
    WARNING:guardrails-ai:Validator with id 1-indexed was not found in the registry!  Ignoring...
    WARNING:guardrails-ai:Invalid arguments! ('1-indexed', 'noop')
    /Users/dtam/dev/guardrails/guardrails/validator_service/__init__.py:85: UserWarning: Could not obtain an event loop. Falling back to synchronous validation.
      warnings.warn(
```

</CodeOutputBlock>

By printing the guard's state, we can see the final, validated output, as well as the steps guardrails took to ensure structure.


```python
print(guard.history.last.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />└── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #e7dfeb\">╭───────────────────────────────────────────────</span> Messages <span style=\"background-color: #e7dfeb\">────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                      </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │ user │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Generate a dataset of fake user orders. Each row of the dataset should be valid. The format  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ should not be a list, it should be a JSON object.                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Given below is XML that describes the information to extract from this document and the tags │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ to extract it into.                                                                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;output&gt;                                                                                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;list description=\"Generate a list of users and how many orders they have placed in the    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ past.\" format=\"guardrails/valid_length: 10 10\" name=\"user_orders\" required=\"true\"&gt;           │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;object format=\"guardrails/valid_length: 10 10\" required=\"true\"&gt;                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;integer description=\"The user's id.\" name=\"user_id\" required=\"true\"&gt;&lt;/integer&gt;        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;string description=\"The user's first name and last name\"                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/two_words\" name=\"user_name\" required=\"true\"&gt;&lt;/string&gt;                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │       &lt;integer description=\"The number of orders the user has placed\"                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ format=\"guardrails/valid_range: 0 50\" name=\"num_orders\" required=\"true\"&gt;&lt;/integer&gt;           │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     &lt;/object&gt;                                                                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │   &lt;/list&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ &lt;/output&gt;                                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ ONLY return a valid JSON object (no other text is necessary), where the key of the field in  │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ JSON is the `name` attribute of the corresponding XML, and the value is of the type          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ specified by the corresponding XML's tag. The JSON MUST conform to the XML format, including │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ any types and format requests e.g. requests for lists, objects and specific types. Be        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ correct and concise. If you are unsure anywhere, enter `null`.                               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ Here are examples of simple (XML, JSON) pairs that show the expected behavior:               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE',        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 'STRING TWO', etc.]}`                                                                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ name=\"index\" format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index':     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ 1}}`                                                                                         │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ an example of output may look like this:                                                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ {                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │         \"user_orders\": [{                                                                    │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ │ │                                                                                          │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │         \"user_id\": 1,                                                                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │         \"user_name\": \"John Mcdonald\",                                                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │         \"num_orders\": 6                                                                      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │     }]                                                                                       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │ }                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │      │                                                                                              │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └──────┴──────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭────────────────────────────────────────────</span> Raw LLM Output <span style=\"background-color: #f5f5dc\">─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"user_orders\": [                                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 2,                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Jane Smith\",                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 12                                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 5,                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Michael Jones\",                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 18                                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 10,                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Mary Sue\",                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 9                                                                             │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 3,                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"David Miller\",                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 7                                                                             │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 15,                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Eva Gonzalez\",                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 15                                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 8,                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"William Martinez\",                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 1                                                                             │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 12,                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Sophia Lee\",                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 10                                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 6,                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Robert Wilson\",                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 22                                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 18,                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Albert Taylor\",                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 3                                                                             │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 14,                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Olivia Davis\",                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 17                                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_id\": 17,                                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"user_name\": \"Jonathan Smith\",                                                              │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│             \"num_orders\": 5                                                                             │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         }                                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     ]                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭───────────────────────────────────────────</span> Validated Output <span style=\"background-color: #f0fff0\">────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'user_orders': [                                                                                    │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 2, 'user_name': 'Jane Smith', 'num_orders': 12},                                    │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 5, 'user_name': 'Michael Jones', 'num_orders': 18},                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 10, 'user_name': 'Mary Sue', 'num_orders': 9},                                      │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 3, 'user_name': 'David Miller', 'num_orders': 7},                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 15, 'user_name': 'Eva Gonzalez', 'num_orders': 15},                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 8, 'user_name': 'William Martinez', 'num_orders': 1},                               │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 12, 'user_name': 'Sophia Lee', 'num_orders': 10},                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 6, 'user_name': 'Robert Wilson', 'num_orders': 22},                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 18, 'user_name': 'Albert Taylor', 'num_orders': 3},                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 14, 'user_name': 'Olivia Davis', 'num_orders': 17},                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'user_id': 17, 'user_name': 'Jonathan Smith', 'num_orders': 5}                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     ]                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />
