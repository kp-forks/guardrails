import CodeOutputBlock from '../../../docusaurus/code-output-block.jsx';

```bash
guardrails hub install hub://guardrails/regex_match --quiet
```

<CodeOutputBlock lang="bash">

```
    Installing hub://guardrails/regex_match...
    ✅Successfully installed guardrails/regex_match!
    
    
```

</CodeOutputBlock>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->

# Validating Responses using Regex

This notebook demonstrates how to synthesize regex-validated responses from an LLM. 

In this example, we'll ask GPT-3.5 to give us a phone number, and make sure it's just separated by dashes - so something of the format 123-456-7890.


### Define the RegEx


```python
regex = "\\d{3}-\\d{3}-\\d{4}"
```

### Import Guardrails and openai


```python
from guardrails import Guard
from guardrails.hub import RegexMatch
from rich import print

# Set your OPENAI_API_KEY as an environment variable
# import os
# os.environ["OPENAI_API_KEY"] = "YOUR_API_KEY"
```

<CodeOutputBlock lang="python">

```
    /Users/dtam/.pyenv/versions/3.12.3/envs/litellm/lib/python3.12/site-packages/sentence_transformers/cross_encoder/CrossEncoder.py:13: TqdmExperimentalWarning: Using `tqdm.autonotebook.tqdm` in notebook mode. Use `tqdm.tqdm` instead to force console mode (e.g. in jupyter console)
      from tqdm.autonotebook import tqdm, trange
```

</CodeOutputBlock>

### Create the guard and prompt

We use a simple string guard with the RegexMatch validator. We can see that the initial response is malformatted, but the reask gets the LLM to respond correctly.


```python
guard = Guard.for_string(
    validators=[RegexMatch(regex=regex, match_type="search", on_fail="reask")]
)

guard(
    messages=[
        {
            "role": "user",
            "content": "I am writing a movie and need a fake phone number. Generate a fake phone number. Do not write anything other than the phone number.",
        }
    ],
    model="gpt-4-turbo",
)

print(guard.history.last.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "/Users/dtam/dev/guardrails/guardrails/validator_service/__init__.py:85: UserWarning: Could not obtain an event loop. Falling back to synchronous validation.<br />      warnings.warn(<br />    /Users/dtam/dev/guardrails/guardrails/validator_service/__init__.py:85: UserWarning: Could not obtain an event loop. Falling back to synchronous validation.<br />      warnings.warn(<br /><br /><br /><br /><br /><pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />├── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />│   │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                      </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │ user │ I am writing a movie and need a fake phone number. Generate a fake phone number. Do not      │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ │      │ write anything other than the phone number.                                                  │ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ └──────┴──────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│ (555) 012-3456                                                                                          │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│ FieldReAsk(                                                                                             │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     incorrect_value='(555) 012-3456',                                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     fail_results=[                                                                                      │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         FailResult(                                                                                     │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             outcome='fail',                                                                             │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             error_message='Result must match \\d{3}-\\d{3}-\\d{4}',                                     │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             fix_value='idfgxprs581-360-9865idfgxprs',                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             error_spans=None,                                                                           │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             metadata=None,                                                                              │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             validated_chunk=None                                                                        │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         )                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     ],                                                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     additional_properties={},                                                                           │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     path=None                                                                                           │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│ )                                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br />└── ╭────────────────────────────────────────────────── Step 1 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #e7dfeb\">╭─────────────────────────────────────────────── Messages ────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\">   Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content                                                                                    </span><span style=\"background-color: #e7dfeb\">┃ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │ system │ You are a helpful assistant.                                                               │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ├────────┼────────────────────────────────────────────────────────────────────────────────────────────┤ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │   user │ This was a previous response you generated:                                                │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ ======                                                                                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ (555) 012-3456                                                                             │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ ======                                                                                     │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Generate a new response that corrects your old response such that the following issues are │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ fixed                                                                                      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ - Result must match \d{3}-\d{3}-\d{4}                                                      │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Your generated response should satisfy the following properties:                           │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ - guardrails/regex_match: regex=\d{3}-\d{3}-\d{4} match_type=search                        │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │ Don't talk; just go.                                                                       │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ │        │                                                                                            │ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └────────┴────────────────────────────────────────────────────────────────────────────────────────────┘ │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ 555-012-3456                                                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ '555-012-3456'                                                                                          │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />
