import CodeOutputBlock from '../../docusaurus/code-output-block.jsx';

# OpenAI

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->

You can use `Guardrails` with OpenAI's function calling API using a combination of Guardrails and Pydantic. In this notebook, we walk through an example of how to use Guardrails with OpenAI's function calling API for generating structured data.


```python
import openai

from pydantic import BaseModel
from rich import print
from typing import List

import guardrails as gd

# Set your OPENAI_API_KEY as an environment variable
# import os
# os.environ['OPENAI_API_KEY'] = "YOUR_API_KEY"
```

## Step 1: Create a Pydantic Model representing the data you want to generate


```python
class Movie(BaseModel):
    rank: int
    title: str
    details: str


class Director(BaseModel):
    """A movie director"""

    name: str
    movies: List[Movie]
```

## Step 2: Create a `Guard` object with your Pydantic Model


```python
guard = gd.Guard.for_pydantic(Director, prompt="Generate data about a movie director.")

raw_llm_output, validated_output, *rest = guard(
    openai.chat.completions.create,
    model="gpt-4-0613",
    max_tokens=1024,
    temperature=0.0,
)
```


```python
print(validated_output)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\">{</span><br />    <span style=\"color: #008000; text-decoration-color: #008000\">'name'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'Christopher Nolan'</span>,<br />    <span style=\"color: #008000; text-decoration-color: #008000\">'movies'</span>: <span style=\"font-weight: bold\">[</span><br />        <span style=\"font-weight: bold\">{</span><br />            <span style=\"color: #008000; text-decoration-color: #008000\">'rank'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>,<br />            <span style=\"color: #008000; text-decoration-color: #008000\">'title'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'Inception'</span>,<br />            <span style=\"color: #008000; text-decoration-color: #008000\">'details'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'A thief who steals corporate secrets through the use of dream-sharing technology is given </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">the inverse task of planting an idea into the mind of a CEO.'</span><br />        <span style=\"font-weight: bold\">}</span>,<br />        <span style=\"font-weight: bold\">{</span><br />            <span style=\"color: #008000; text-decoration-color: #008000\">'rank'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span>,<br />            <span style=\"color: #008000; text-decoration-color: #008000\">'title'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'The Dark Knight'</span>,<br />            <span style=\"color: #008000; text-decoration-color: #008000\">'details'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'When the menace known as the Joker wreaks havoc and chaos on the people of Gotham, Batman </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">must accept one of the greatest psychological and physical tests of his ability to fight injustice.'</span><br />        <span style=\"font-weight: bold\">}</span>,<br />        <span style=\"font-weight: bold\">{</span><br />            <span style=\"color: #008000; text-decoration-color: #008000\">'rank'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span>,<br />            <span style=\"color: #008000; text-decoration-color: #008000\">'title'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'Interstellar'</span>,<br />            <span style=\"color: #008000; text-decoration-color: #008000\">'details'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"A team of explorers travel through a wormhole in space in an attempt to ensure humanity's </span><br /><span style=\"color: #008000; text-decoration-color: #008000\">survival.\"</span><br />        <span style=\"font-weight: bold\">}</span><br />    <span style=\"font-weight: bold\">]</span><br /><span style=\"font-weight: bold\">}</span><br /></pre>"}} />

## (Optional) Step 3: View logs of the prompt and response


```python
guard.history.last.tree
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />└── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #f0f8ff\">╭──────────────────────────────────────────────── Prompt ─────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ Generate data about a movie director.                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   \"director\": {                                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"name\": \"Christopher Nolan\",                                                                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"birth_date\": \"1970-07-30\",                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"nationality\": \"British\",                                                                           │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"awards\": [                                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       {                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"name\": \"Academy Award for Best Director\",                                                      │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"year\": 2010                                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       },                                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       {                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"name\": \"Golden Globe Award for Best Director\",                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"year\": 2011                                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       },                                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       {                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"name\": \"BAFTA Award for Best Direction\",                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"year\": 2011                                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       }                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"movies\": [                                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       {                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"title\": \"Memento\",                                                                             │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"year\": 2000,                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"genre\": \"Mystery/Thriller\"                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       },                                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       {                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"title\": \"The Dark Knight\",                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"year\": 2008,                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"genre\": \"Action/Crime\"                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       },                                                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       {                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"title\": \"Inception\",                                                                           │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"year\": 2010,                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│         \"genre\": \"Science Fiction/Action\"                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       }                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     ]                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   }                                                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'director': {                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         'name': 'Christopher Nolan',                                                                    │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         'birth_date': '1970-07-30',                                                                     │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         'nationality': 'British',                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         'awards': [                                                                                     │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│             {'name': 'Academy Award for Best Director', 'year': 2010},                                  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│             {'name': 'Golden Globe Award for Best Director', 'year': 2011},                             │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│             {'name': 'BAFTA Award for Best Direction', 'year': 2011}                                    │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         ],                                                                                              │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         'movies': [                                                                                     │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│             {'title': 'Memento', 'year': 2000, 'genre': 'Mystery/Thriller'},                            │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│             {                                                                                           │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│                 'title': 'The Dark Knight',                                                             │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│                 'year': 2008,                                                                           │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│                 'genre': 'Action/Crime'                                                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│             },                                                                                          │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│             {                                                                                           │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│                 'title': 'Inception',                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│                 'year': 2010,                                                                           │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│                 'genre': 'Science Fiction/Action'                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│             }                                                                                           │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         ]                                                                                               │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     }                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />
