import CodeOutputBlock from '../../docusaurus/code-output-block.jsx';

# Azure OpenAI

You can use Guardrails with Azure's OpenAI integration in a few quick steps.

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->

## Step 1: Configure the `openai` library to use Azure


```python
import os
import openai

openai.api_type = "azure"
openai.api_version = "2023-05-15"
openai.api_base = os.environ.get("AZURE_OPENAI_API_BASE")
openai.api_key = os.environ.get("AZURE_OPENAI_API_KEY")
```

## Step 2: Define a rail spec


```python
rail = """
<rail version="0.1">
<output>
    <object name="bank_run">
        <string
            name="explanation"
            description="A paragraph about what a bank run is."
            format="length: 100 320"
            on-fail-length="reask"
        />
        <url
            name="follow_up_url"
            description="A web URL where I can read more about bank runs."
            format="valid-url"
            on-fail-valid-url="reask"
        />
    </object>
</output>

<prompt>
Explain what a bank run is in a tweet.

${output_schema}

${gr.json_suffix_prompt_v2_wo_none}
</prompt>
</rail>"""
```

## Step 3: Create a `Guard` object with your spec


```python
import guardrails as gr

guard = gr.Guard.for_rail_string(rail)
```

## Step 4: Invoke the `guard` with the Azure OpenAI engine


```python
raw_llm_output, validated_output, *rest = guard(
    openai.chat.completions.create,
    engine=os.environ.get("AZURE_OPENAI_API_ENGINE"),
    max_tokens=1024,
    temperature=0.3,
)
```

<CodeOutputBlock lang="python">

```
    /Users/rafael/guardrails/guardrails/prompt/prompt.py:23: UserWarning: Prompt does not have any variables, if you are migrating follow the new variable convention documented here: https://docs.guardrailsai.com/0-2-migration/
      warnings.warn(
```

</CodeOutputBlock>

## (Optional) Step 5: View logs of the prompt and response


```python
guard.history.last.tree
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />└── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #f0f8ff\">╭──────────────────────────────────────────────── Prompt ─────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ Explain what a bank run is in a tweet.                                                                  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ &lt;output&gt;                                                                                                │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     &lt;object name=\"bank_run\"&gt;                                                                            │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         &lt;string name=\"explanation\" description=\"A paragraph about what a bank run is.\" format=\"length:  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ min=100 max=320\"/&gt;                                                                                      │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         &lt;url name=\"follow_up_url\" description=\"A web URL where I can read more about bank runs.\"        │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ format=\"valid-url\"/&gt;                                                                                    │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     &lt;/object&gt;                                                                                           │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ &lt;/output&gt;                                                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ ONLY return a valid JSON object (no other text is necessary). The JSON MUST conform to the XML format,  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ including any types and format requests e.g. requests for lists, objects and specific types. Be correct │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ and concise.                                                                                            │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #fff0f2\">╭───────────────────────────────────────────── Instructions ──────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ You are a helpful assistant, able to express yourself purely through JSON, strictly and precisely       │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ adhering to the provided XML schemas.                                                                   │</span> │<br />    │ <span style=\"background-color: #fff0f2\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╭──────────────────────────────────────────── Message History ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━┓                                                                                      │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content </span><span style=\"background-color: #e7dfeb\">┃                                                                                      │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━┩                                                                                      │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ └──────┴─────────┘                                                                                      │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   \"bank_run\": {                                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"explanation\": \"A bank run occurs when a large number of customers withdraw their deposits          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ simultaneously due to fears the bank might become insolvent. As banks typically keep only a fraction of │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ deposits as cash reserves, a bank run can lead to bankruptcy.\",                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     \"follow_up_url\": \"https://www.investopedia.com/terms/b/bankrun.asp\"                                 │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   }                                                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'bank_run': {                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         'explanation': 'A bank run occurs when a large number of customers withdraw their deposits      │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ simultaneously due to fears the bank might become insolvent. As banks typically keep only a fraction of │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ deposits as cash reserves, a bank run can lead to bankruptcy.',                                         │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         'follow_up_url': 'https://www.investopedia.com/terms/b/bankrun.asp'                             │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     }                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />
